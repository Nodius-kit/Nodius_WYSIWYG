<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nodius Editor — Custom Plugin Example</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, sans-serif; background: #f5f5f5; padding: 2rem; }
    h1 { margin-bottom: 0.5rem; color: #333; }
    p.subtitle { margin-bottom: 1.5rem; color: #666; font-size: 14px; }
    #editor-root { max-width: 800px; margin: 0 auto; }
    pre#source {
      max-width: 800px; margin: 2rem auto; padding: 1rem;
      background: #1e1e1e; color: #d4d4d4; border-radius: 8px;
      font-size: 13px; overflow-x: auto; white-space: pre-wrap;
    }
    pre#source .comment { color: #6a9955; }
    pre#source .keyword { color: #569cd6; }
    pre#source .string { color: #ce9178; }
  </style>
</head>
<body>
  <div id="editor-root">
    <h1>Nodius Editor — Custom Plugin</h1>
    <p class="subtitle">
      This example shows how to create a custom "strikethrough" plugin
      with its own mark type, keyboard shortcut, and toolbar button.
    </p>
    <div id="editor-container"></div>
  </div>

  <pre id="source">
// ─── Custom Strikethrough Plugin ─────────────────────────────
//
// A plugin adds: markTypes, commands, keymaps, and toolbarItems.
// This is all you need to create a new formatting option.

const strikethroughPlugin = {
  name: 'strikethrough',

  // Register a new mark type
  markTypes: [{
    name: 'strikethrough',
    toDOM: () => ['s', 0],                // Render as &lt;s&gt; tag
    parseDOM: [{ tag: 's' }, { tag: 'del' }],
  }],

  // Register commands
  commands: {
    'toggle-strikethrough': (editor) => {
      // Toggle logic is the same pattern as bold/italic
      const state = editor.getState();
      const sel = state.selection;
      if (!sel) return false;

      const { anchor, focus } = sel;
      const from = Math.min(anchor.offset, focus.offset);
      const to = Math.max(anchor.offset, focus.offset);
      if (from === to) return false;

      const mark = { type: 'strikethrough' };
      const blockPath = [anchor.blockIndex];
      const length = to - from;

      // Check if already has the mark
      const block = state.doc.children[anchor.blockIndex];
      const hasIt = block?.children.some(
        (c) => c.kind === 'text' &amp;&amp; c.marks.some((m) => m.type === 'strikethrough')
      );

      editor.dispatch({
        operations: [{
          type: hasIt ? 'remove_mark' : 'add_mark',
          path: blockPath,
          offset: from,
          length,
          mark,
        }],
        origin: 'input',
        timestamp: Date.now(),
      });
      return true;
    },
  },

  // Keyboard shortcut
  keymaps: { 'Mod-Shift-s': 'toggle-strikethrough' },

  // Toolbar button
  toolbarItems: [{
    name: 'strikethrough',
    command: 'toggle-strikethrough',
    icon: '&lt;svg viewBox="0 0 24 24" width="16" height="16"&gt;' +
          '&lt;line x1="4" y1="12" x2="20" y2="12" stroke="currentColor" stroke-width="2"/&gt;' +
          '&lt;text x="12" y="18" text-anchor="middle" font-size="14" fill="currentColor"&gt;S&lt;/text&gt;' +
          '&lt;/svg&gt;',
    label: 'Strikethrough',
    order: 35,
  }],
};
  </pre>

  <script type="module">
    import {
      createEditor,
      createHistoryPlugin,
      boldPlugin,
      italicPlugin,
      underlinePlugin,
      toolbarPlugin,
    } from '../dist/index.es.js';

    // ─── Custom Strikethrough Plugin ─────────────────────────
    const strikethroughPlugin = {
      name: 'strikethrough',

      markTypes: [{
        name: 'strikethrough',
        toDOM: () => ['s', 0],
        parseDOM: [{ tag: 's' }, { tag: 'del' }],
      }],

      commands: {
        'toggle-strikethrough': (editor) => {
          const state = editor.getState();
          const sel = state.selection;
          if (!sel) return false;

          const { anchor, focus } = sel;
          const from = Math.min(anchor.offset, focus.offset);
          const to = Math.max(anchor.offset, focus.offset);
          if (from === to) return false;

          const mark = { type: 'strikethrough' };
          const blockPath = [anchor.blockIndex];
          const length = to - from;

          const block = state.doc.children[anchor.blockIndex];
          const hasIt = block?.children.some(
            (c) => c.kind === 'text' && c.marks.some((m) => m.type === 'strikethrough')
          );

          editor.dispatch({
            operations: [{
              type: hasIt ? 'remove_mark' : 'add_mark',
              path: blockPath,
              offset: from,
              length,
              mark,
            }],
            origin: 'input',
            timestamp: Date.now(),
          });
          return true;
        },
      },

      keymaps: { 'Mod-Shift-s': 'toggle-strikethrough' },

      toolbarItems: [{
        name: 'strikethrough',
        command: 'toggle-strikethrough',
        icon: '<svg viewBox="0 0 24 24" width="16" height="16"><line x1="4" y1="12" x2="20" y2="12" stroke="currentColor" stroke-width="2"/><text x="12" y="18" text-anchor="middle" font-size="14" fill="currentColor">S</text></svg>',
        label: 'Strikethrough',
        order: 35,
      }],
    };

    // ─── Editor Setup ────────────────────────────────────────
    const { plugin: historyPlugin } = createHistoryPlugin();

    const editor = createEditor({
      plugins: [
        boldPlugin,
        italicPlugin,
        underlinePlugin,
        strikethroughPlugin,   // Our custom plugin
        toolbarPlugin,
        historyPlugin,
      ],
      toolbar: [
        'bold', 'italic', 'underline', 'strikethrough',
      ],
    });

    editor.mount(document.getElementById('editor-container'));
  </script>
</body>
</html>
